"use strict";const n=require("electron"),u=require("path");require("electron-squirrel-startup")&&n.app.quit();const r=640,l=54,w=600,f=process.platform==="darwin"?"Command+`":"Alt+Space";let s=!1,e=null;function h(){const{width:i}=n.screen.getPrimaryDisplay().workAreaSize,t=new n.BrowserWindow({width:r,height:l,x:Math.round((i-r)/2),y:120,frame:!1,transparent:!0,backgroundColor:"#00000000",hasShadow:!0,alwaysOnTop:!0,skipTaskbar:!0,resizable:!1,movable:!0,show:!1,vibrancy:"popover",visualEffectState:"active",webPreferences:{preload:u.join(__dirname,"preload.js"),contextIsolation:!0,nodeIntegration:!1,sandbox:!0}});return t.loadFile(u.join(__dirname,"../renderer/main_window/index.html")),t.on("blur",()=>{setTimeout(()=>{!s&&t&&t.isVisible()&&a()},100)}),t.webContents.setWindowOpenHandler(({url:o})=>o.startsWith("https:")||o.startsWith("http:")?(n.shell.openExternal(o),{action:"deny"}):{action:"allow"}),t}function d(){if(!e)return;const i=n.screen.getCursorScreenPoint(),t=n.screen.getDisplayNearestPoint(i),o=Math.round(t.workArea.x+(t.workArea.width-r)/2);e.setPosition(o,120),e.setSize(r,l,!1),e.show(),e.focus(),s=!0,e.webContents.send("flow:show")}function a(){e!=null&&e.isVisible()&&(s=!1,e.hide(),e.webContents.send("flow:hide"))}function g(){if(!e){e=h(),e.once("ready-to-show",d);return}e.isVisible()?a():d()}n.ipcMain.on("flow:hide",a);n.ipcMain.on("flow:resize",(i,t)=>{if(!e)return;const o=Math.max(l,Math.min(w,Math.ceil(t))),[p,c]=e.getSize();c!==o&&(console.log(`[Resize] ${c} -> ${o}`),e.setSize(p,o,!1))});n.ipcMain.on("shell:openExternal",(i,t)=>{n.shell.openExternal(t),a()});n.ipcMain.handle("theme:get",()=>n.nativeTheme.shouldUseDarkColors);n.ipcMain.on("flow:pin",(i,t)=>{s=t,console.log(`[Pin] Menu ${t?"pinned":"unpinned"}`)});n.app.whenReady().then(()=>{n.globalShortcut.register(f,g),e=h()});n.app.on("will-quit",()=>n.globalShortcut.unregisterAll());n.app.on("window-all-closed",()=>{process.platform!=="darwin"&&n.app.quit()});
